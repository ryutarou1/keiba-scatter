<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>クッション値×含水率 - 京都</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans JP', sans-serif;
  background: #fff; color: #1e293b; overflow-x: hidden;
}
.header {
  background: #fff; border-bottom: 1px solid #e2e8f0;
  padding: 12px 16px; position: sticky; top: 0; z-index: 100;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
.header h1 { font-size: 16px; font-weight: 900; letter-spacing: -0.5px; }
.header .sub { font-size: 11px; color: #64748b; margin-top: 2px; }
.header .target {
  display: inline-flex; gap: 12px; margin-top: 4px;
  font-size: 11px; font-weight: 700; font-family: monospace;
}
.header .target span {
  background: #f8fafc; border: 1px solid #e2e8f0;
  padding: 2px 8px; border-radius: 4px;
}
.main { display: flex; flex-direction: column; }
@media (min-width: 768px) { .main { flex-direction: row; height: calc(100vh - 70px); } }
.chart-area { position: relative; width: 100%; height: 45vh; min-height: 300px; }
@media (min-width: 768px) { .chart-area { flex: 1; height: 100%; } }
canvas { display: block; width: 100% !important; height: 100% !important; touch-action: pan-y; }
.panel {
  border-top: 1px solid #e2e8f0; overflow-y: auto; padding: 8px; background: #f8fafc;
}
@media (min-width: 768px) {
  .panel { width: 320px; border-top: none; border-left: 1px solid #e2e8f0; height: 100%; }
}
.horse-btn {
  display: flex; align-items: center; gap: 10px; width: 100%;
  padding: 10px 14px; margin-bottom: 4px; border: 1px solid #e2e8f0;
  border-radius: 12px; background: #fff; cursor: pointer;
  transition: all 0.2s; font-size: 14px; font-weight: 700; color: #1e293b;
  -webkit-tap-highlight-color: transparent;
}
.horse-btn:active { transform: scale(0.98); }
.horse-btn.selected {
  border-color: #f59e0b; background: #fffbeb;
  box-shadow: 0 0 0 2px rgba(245,158,11,0.2);
}
.horse-btn .checkbox {
  width: 20px; height: 20px; border: 2px solid #cbd5e1; border-radius: 5px;
  flex-shrink: 0; display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; font-size: 14px; color: #fff;
}
.horse-btn.selected .checkbox {
  background: #f59e0b; border-color: #f59e0b;
}
.horse-btn .count { font-size: 10px; color: #94a3b8; font-weight: 600; margin-left: auto; }
.horse-btn .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.horse-detail { display: none; padding: 8px 4px; }
.horse-detail.show { display: block; }
.race-card { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 6px; }
.race-item {
  padding: 8px 10px; border-radius: 10px; border: 1px solid #e2e8f0;
  background: #fff; font-size: 10px;
}
.race-item.ideal { background: #ecfdf5; border-color: #a7f3d0; }
.race-item .date { color: #94a3b8; font-weight: 600; font-family: monospace; }
.race-item .result { font-size: 13px; font-weight: 900; }
.race-item .cond { color: #64748b; font-weight: 700; }
.legend {
  display: flex; gap: 12px; padding: 8px 16px; font-size: 10px;
  font-weight: 700; color: #94a3b8; border-top: 1px solid #e2e8f0; flex-wrap: wrap;
}
.legend span { display: flex; align-items: center; gap: 4px; }
.legend .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
.tooltip {
  display: none; position: fixed; background: rgba(15,23,42,0.95); color: #fff;
  padding: 10px 14px; border-radius: 10px; font-size: 12px; line-height: 1.6;
  pointer-events: none; z-index: 200; max-width: 250px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.tooltip.show { display: block; }
.show-all-btn {
  display: block; width: 100%; padding: 8px; margin-bottom: 8px;
  border: 2px dashed #cbd5e1; border-radius: 12px; background: transparent;
  cursor: pointer; font-size: 13px; font-weight: 700; color: #64748b;
  -webkit-tap-highlight-color: transparent;
}
.show-all-btn:active { background: #f1f5f9; }
</style>
</head>
<body>
<div class="header">
  <h1>京都11R  芝2200m</h1>
  <div class="sub">出走馬 クッション値×含水率 解析</div>
  <div class="target">
    <span>CV: <b style="color:#d97706">10.9</b></span>
    <span>含水率: <b style="color:#2563eb">9.3%</b></span>
    <span style="color:#94a3b8">02/15 京都</span>
  </div>
</div>
<div class="main">
  <div class="chart-area"><canvas id="chart"></canvas><div class="tooltip" id="tooltip"></div></div>
  <div class="panel" id="panel"></div>
</div>
<div class="legend">
  <span><span class="dot" style="background:#dc2626"></span> 同距離帯芝</span>
  <span><span class="dot" style="background:#2563eb"></span> 他距離芝</span>
  <span><span class="dot" style="background:#94a3b8"></span> ダート</span>
  <span>○ 3着以内 / × 4着以下</span>
</div>
<script>
const HORSES = [{"name": "ヘデントール", "races": [{"date": "2025/05/04", "venue": "京都", "surface": "芝", "distance": 3200, "race_name": "天皇賞(春)(GI)", "result": 1, "cushion": 10.6, "moisture": 8.7, "cat": "diff_dist", "good": true}, {"date": "2025/02/22", "venue": "東京", "surface": "芝", "distance": 3400, "race_name": "ダイヤモンドS(GIII)", "result": 1, "cushion": 9.1, "moisture": 12.0, "cat": "diff_dist", "good": true}, {"date": "2024/10/20", "venue": "京都", "surface": "芝", "distance": 3000, "race_name": "菊花賞(GI)", "result": 2, "cushion": 10.6, "moisture": 7.5, "cat": "diff_dist", "good": true}, {"date": "2024/08/17", "venue": "新潟", "surface": "芝", "distance": 2200, "race_name": "日本海S(3勝クラス)", "result": 1, "cushion": 9.1, "moisture": 12.4, "cat": "same_dist", "good": true}, {"date": "2024/06/16", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "町田特別(2勝クラス)", "result": 1, "cushion": 8.3, "moisture": 14.5, "cat": "same_dist", "good": true}, {"date": "2024/04/27", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "テレビ東京杯青葉賞(GII)", "result": 8, "cushion": 9.2, "moisture": 16.0, "cat": "same_dist", "good": false}, {"date": "2024/03/09", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "3歳1勝クラス", "result": 1, "cushion": 9.4, "moisture": 10.1, "cat": "same_dist", "good": true}, {"date": "2024/01/13", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "3歳未勝利", "result": 1, "cushion": 10.1, "moisture": 12.2, "cat": "same_dist", "good": true}, {"date": "2023/11/18", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "2歳新馬", "result": 2, "cushion": 9.7, "moisture": 13.8, "cat": "same_dist", "good": true}]}, {"name": "ヨーホーレイク", "races": [{"date": "2025/11/30", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "ジャパンC(GI)", "result": 14, "cushion": 9.3, "moisture": 14.9, "cat": "same_dist", "good": false}, {"date": "2025/09/21", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "産経賞オールカマー(GII)", "result": 3, "cushion": 9.5, "moisture": 13.6, "cat": "same_dist", "good": true}, {"date": "2025/06/15", "venue": "阪神", "surface": "芝", "distance": 2200, "race_name": "宝塚記念(GI)", "result": 17, "cushion": 7.8, "moisture": 17.0, "cat": "same_dist", "good": false}, {"date": "2025/04/06", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "大阪杯(GI)", "result": 3, "cushion": 9.2, "moisture": 13.2, "cat": "same_dist", "good": true}, {"date": "2025/02/16", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "京都記念(GII)", "result": 1, "cushion": 9.5, "moisture": 11.3, "cat": "same_dist", "good": true}, {"date": "2024/10/06", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "毎日王冠(GII)", "result": 7, "cushion": 9.6, "moisture": 14.9, "cat": "diff_dist", "good": false}, {"date": "2024/06/01", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "鳴尾記念(GIII)", "result": 1, "cushion": 10.8, "moisture": 7.4, "cat": "same_dist", "good": true}, {"date": "2024/05/05", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "新潟大賞典(GIII)", "result": 3, "cushion": 9.0, "moisture": 10.8, "cat": "same_dist", "good": true}, {"date": "2024/03/10", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "金鯱賞(GII)", "result": 3, "cushion": 9.4, "moisture": 12.8, "cat": "same_dist", "good": true}, {"date": "2022/01/16", "venue": "中京", "surface": "芝", "distance": 2200, "race_name": "日経新春杯(GII)", "result": 1, "cushion": 10.1, "moisture": 13.4, "cat": "same_dist", "good": true}]}, {"name": "サフィラ", "races": [{"date": "2025/11/16", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "エリザベス女王杯(GI)", "result": 7, "cushion": 11.3, "moisture": 9.2, "cat": "same_dist", "good": false}, {"date": "2025/10/12", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "アイルランドT(GII)", "result": 12, "cushion": 10.2, "moisture": 12.2, "cat": "diff_dist", "good": false}, {"date": "2025/05/18", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "ヴィクトリアマイル(GI)", "result": 13, "cushion": 8.9, "moisture": 17.0, "cat": "diff_dist", "good": false}, {"date": "2025/04/12", "venue": "阪神", "surface": "芝", "distance": 1600, "race_name": "サンスポ杯阪神牝馬S(GII)", "result": 1, "cushion": 9.2, "moisture": 12.1, "cat": "diff_dist", "good": true}, {"date": "2025/02/09", "venue": "京都", "surface": "芝", "distance": 1600, "race_name": "斑鳩S(3勝クラス)", "result": 3, "cushion": 9.9, "moisture": 11.1, "cat": "diff_dist", "good": true}, {"date": "2024/12/21", "venue": "京都", "surface": "芝", "distance": 1800, "race_name": "3歳以上2勝クラス", "result": 1, "cushion": 11.2, "moisture": 8.8, "cat": "diff_dist", "good": true}, {"date": "2024/11/30", "venue": "京都", "surface": "芝", "distance": 1800, "race_name": "3歳以上2勝クラス", "result": 3, "cushion": 11.5, "moisture": 8.5, "cat": "diff_dist", "good": true}, {"date": "2024/09/15", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "関西TVローズS(GII)", "result": 11, "cushion": 9.1, "moisture": 14.4, "cat": "same_dist", "good": false}, {"date": "2024/05/19", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "優駿牝馬(GI)", "result": 13, "cushion": 9.9, "moisture": 12.3, "cat": "same_dist", "good": false}, {"date": "2024/02/10", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "デイリー杯クイーンC(GIII)", "result": 9, "cushion": 9.6, "moisture": 16.4, "cat": "diff_dist", "good": false}]}, {"name": "エコロディノス", "races": [{"date": "2025/12/14", "venue": "阪神", "surface": "芝", "distance": 2200, "race_name": "オリオンS(3勝クラス)", "result": 1, "cushion": 8.3, "moisture": 15.2, "cat": "same_dist", "good": true}, {"date": "2025/11/01", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "北野特別(2勝クラス)", "result": 1, "cushion": 10.4, "moisture": 10.5, "cat": "same_dist", "good": true}, {"date": "2025/09/14", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "能勢特別(2勝クラス)", "result": 3, "cushion": 9.0, "moisture": 13.0, "cat": "same_dist", "good": true}, {"date": "2025/06/15", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 1, "cushion": 7.8, "moisture": 17.0, "cat": "same_dist", "good": true}, {"date": "2025/03/29", "venue": "阪神", "surface": "芝", "distance": 1800, "race_name": "毎日杯(GIII)", "result": 5, "cushion": 8.9, "moisture": 14.3, "cat": "diff_dist", "good": false}, {"date": "2025/01/05", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "3歳1勝クラス", "result": 3, "cushion": 9.4, "moisture": 11.6, "cat": "same_dist", "good": true}, {"date": "2024/11/10", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "2歳新馬", "result": 1, "cushion": 11.1, "moisture": 7.9, "cat": "same_dist", "good": true}]}, {"name": "バビット", "races": [{"date": "2025/11/22", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "福島記念(GIII)", "result": 12, "cushion": 9.2, "moisture": 10.3, "cat": "same_dist", "good": false}, {"date": "2025/03/29", "venue": "中山", "surface": "芝", "distance": 2500, "race_name": "日経賞(GII)", "result": 11, "cushion": 9.6, "moisture": 12.6, "cat": "diff_dist", "good": false}, {"date": "2025/02/16", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "京都記念(GII)", "result": 4, "cushion": 9.5, "moisture": 11.3, "cat": "same_dist", "good": false}, {"date": "2024/11/30", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "チャレンジC(GIII)", "result": 14, "cushion": 11.5, "moisture": 8.5, "cat": "same_dist", "good": false}, {"date": "2024/10/06", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "京都大賞典(GII)", "result": 8, "cushion": 10.7, "moisture": 9.1, "cat": "same_dist", "good": false}, {"date": "2024/07/07", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "七夕賞(GIII)", "result": 11, "cushion": 9.2, "moisture": 10.8, "cat": "same_dist", "good": false}, {"date": "2024/06/01", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "鳴尾記念(GIII)", "result": 7, "cushion": 10.8, "moisture": 7.4, "cat": "same_dist", "good": false}, {"date": "2024/04/14", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "福島民報杯(L)", "result": 16, "cushion": 9.1, "moisture": 9.6, "cat": "same_dist", "good": false}, {"date": "2024/02/11", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "京都記念(GII)", "result": 3, "cushion": 8.8, "moisture": 9.9, "cat": "same_dist", "good": true}, {"date": "2024/01/21", "venue": "京都", "surface": "ダ", "distance": 1800, "race_name": "東海テレビ杯東海S(GII)", "result": 16, "cushion": 6.8, "moisture": 15.9, "cat": "diff_surface", "good": false}]}, {"name": "エリキング", "races": [{"date": "2025/10/26", "venue": "京都", "surface": "芝", "distance": 3000, "race_name": "菊花賞(GI)", "result": 2, "cushion": 9.7, "moisture": 12.0, "cat": "diff_dist", "good": true}, {"date": "2025/09/21", "venue": "阪神", "surface": "芝", "distance": 2400, "race_name": "神戸新聞杯(GII)", "result": 1, "cushion": 9.2, "moisture": 11.6, "cat": "same_dist", "good": true}, {"date": "2025/06/01", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "東京優駿(GI)", "result": 5, "cushion": 9.2, "moisture": 17.7, "cat": "same_dist", "good": false}, {"date": "2025/04/20", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "皐月賞(GI)", "result": 11, "cushion": 10.6, "moisture": 10.8, "cat": "same_dist", "good": false}, {"date": "2024/11/23", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "ラジオN杯京都2歳S(GIII)", "result": 1, "cushion": 11.3, "moisture": 9.0, "cat": "same_dist", "good": true}, {"date": "2024/09/21", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "野路菊S(OP)", "result": 1, "cushion": 10.2, "moisture": 12.3, "cat": "same_dist", "good": true}, {"date": "2024/06/23", "venue": "京都", "surface": "芝", "distance": 1800, "race_name": "2歳新馬", "result": 1, "cushion": 8.9, "moisture": 13.7, "cat": "diff_dist", "good": true}]}, {"name": "メイショウブレゲ", "races": [{"date": "2026/01/05", "venue": "京都", "surface": "芝", "distance": 3000, "race_name": "万葉S(OP)", "result": 7, "cushion": 10.8, "moisture": 8.8, "cat": "diff_dist", "good": false}, {"date": "2025/12/06", "venue": "中山", "surface": "芝", "distance": 3600, "race_name": "ステイヤーズS(GII)", "result": 10, "cushion": 10.1, "moisture": 10.9, "cat": "diff_dist", "good": false}, {"date": "2025/11/09", "venue": "東京", "surface": "芝", "distance": 2500, "race_name": "アルゼンチン共和国杯(GII)", "result": 16, "cushion": 9.1, "moisture": 13.0, "cat": "diff_dist", "good": false}, {"date": "2025/10/05", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "京都大賞典(GII)", "result": 14, "cushion": 10.0, "moisture": 10.3, "cat": "same_dist", "good": false}, {"date": "2025/06/01", "venue": "東京", "surface": "芝", "distance": 2500, "race_name": "目黒記念(GII)", "result": 17, "cushion": 9.2, "moisture": 17.7, "cat": "diff_dist", "good": false}, {"date": "2025/02/22", "venue": "東京", "surface": "芝", "distance": 3400, "race_name": "ダイヤモンドS(GIII)", "result": 7, "cushion": 9.1, "moisture": 12.0, "cat": "diff_dist", "good": false}, {"date": "2025/01/06", "venue": "中京", "surface": "芝", "distance": 3000, "race_name": "万葉S(OP)", "result": 9, "cushion": 9.4, "moisture": 10.7, "cat": "diff_dist", "good": false}, {"date": "2024/11/30", "venue": "中山", "surface": "芝", "distance": 3600, "race_name": "ステイヤーズS(GII)", "result": 5, "cushion": 9.8, "moisture": 12.2, "cat": "diff_dist", "good": false}, {"date": "2024/11/03", "venue": "東京", "surface": "芝", "distance": 2500, "race_name": "アルゼンチン共和国杯(GII)", "result": 7, "cushion": 9.7, "moisture": 11.9, "cat": "diff_dist", "good": false}, {"date": "2024/10/06", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "京都大賞典(GII)", "result": 3, "cushion": 10.7, "moisture": 9.1, "cat": "same_dist", "good": true}]}, {"name": "シェイクユアハート", "races": [{"date": "2025/12/13", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "中日新聞杯(GIII)", "result": 1, "cushion": 10.0, "moisture": 10.8, "cat": "same_dist", "good": true}, {"date": "2025/11/15", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "アンドロメダS(L)", "result": 2, "cushion": 10.8, "moisture": 9.0, "cat": "same_dist", "good": true}, {"date": "2025/08/31", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "新潟記念(GIII)", "result": 11, "cushion": 9.5, "moisture": 12.3, "cat": "same_dist", "good": false}, {"date": "2025/07/20", "venue": "小倉", "surface": "芝", "distance": 2000, "race_name": "小倉記念(GIII)", "result": 2, "cushion": 9.6, "moisture": 9.3, "cat": "same_dist", "good": true}, {"date": "2025/06/07", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "垂水S(3勝クラス)", "result": 1, "cushion": 8.7, "moisture": 14.6, "cat": "same_dist", "good": true}, {"date": "2025/05/11", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "烏丸S(3勝クラス)", "result": 3, "cushion": 10.2, "moisture": 9.5, "cat": "same_dist", "good": true}, {"date": "2025/03/30", "venue": "阪神", "surface": "芝", "distance": 2400, "race_name": "御堂筋S(3勝クラス)", "result": 4, "cushion": 9.1, "moisture": 14.1, "cat": "same_dist", "good": false}, {"date": "2025/02/15", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "飛鳥S(3勝クラス)", "result": 3, "cushion": 10.5, "moisture": 10.9, "cat": "same_dist", "good": true}, {"date": "2025/01/06", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "寿S(3勝クラス)", "result": 2, "cushion": 9.4, "moisture": 10.7, "cat": "same_dist", "good": true}, {"date": "2024/12/08", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "オリオンS(3勝クラス)", "result": 2, "cushion": 11.6, "moisture": 9.8, "cat": "same_dist", "good": true}]}, {"name": "ドクタードリトル", "races": [{"date": "2026/01/18", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "日経新春杯(GII)", "result": 5, "cushion": 10.5, "moisture": 7.4, "cat": "same_dist", "good": false}, {"date": "2025/12/21", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "ディセンバーS(L)", "result": 9, "cushion": 8.9, "moisture": 15.1, "cat": "diff_dist", "good": false}, {"date": "2025/11/15", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "アンドロメダS(L)", "result": 9, "cushion": 10.8, "moisture": 9.0, "cat": "same_dist", "good": false}, {"date": "2025/10/25", "venue": "京都", "surface": "芝", "distance": 1800, "race_name": "カシオペアS(L)", "result": 5, "cushion": 10.6, "moisture": 7.6, "cat": "diff_dist", "good": false}, {"date": "2025/09/13", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "チャレンジC(GIII)", "result": 13, "cushion": 9.0, "moisture": 11.8, "cat": "same_dist", "good": false}, {"date": "2024/12/07", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "中日新聞杯(GIII)", "result": 10, "cushion": 9.5, "moisture": 13.3, "cat": "same_dist", "good": false}, {"date": "2024/11/10", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "福島記念(GIII)", "result": 7, "cushion": 9.4, "moisture": 10.7, "cat": "same_dist", "good": false}, {"date": "2024/10/06", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "京都大賞典(GII)", "result": 6, "cushion": 10.7, "moisture": 9.1, "cat": "same_dist", "good": false}, {"date": "2024/08/10", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "関ケ原S(3勝クラス)", "result": 1, "cushion": 9.3, "moisture": 10.9, "cat": "same_dist", "good": true}, {"date": "2024/06/22", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "江の島S(3勝クラス)", "result": 8, "cushion": 9.3, "moisture": 17.9, "cat": "diff_dist", "good": false}]}, {"name": "リビアングラス", "races": [{"date": "2026/01/18", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "日経新春杯(GII)", "result": 3, "cushion": 10.5, "moisture": 7.4, "cat": "same_dist", "good": true}, {"date": "2025/11/15", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "アンドロメダS(L)", "result": 6, "cushion": 10.8, "moisture": 9.0, "cat": "same_dist", "good": false}, {"date": "2025/09/21", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "産経賞オールカマー(GII)", "result": 11, "cushion": 9.5, "moisture": 13.6, "cat": "same_dist", "good": false}, {"date": "2025/08/17", "venue": "札幌", "surface": "芝", "distance": 2000, "race_name": "札幌記念(GII)", "result": 6, "cushion": 7.7, "moisture": 12.7, "cat": "same_dist", "good": false}, {"date": "2025/06/15", "venue": "阪神", "surface": "芝", "distance": 2200, "race_name": "宝塚記念(GI)", "result": 7, "cushion": 7.8, "moisture": 17.0, "cat": "same_dist", "good": false}, {"date": "2025/03/29", "venue": "中山", "surface": "芝", "distance": 2500, "race_name": "日経賞(GII)", "result": 4, "cushion": 9.6, "moisture": 12.6, "cat": "diff_dist", "good": false}, {"date": "2025/02/16", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "京都記念(GII)", "result": 2, "cushion": 9.5, "moisture": 11.3, "cat": "same_dist", "good": true}, {"date": "2025/02/02", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "八坂S(3勝クラス)", "result": 1, "cushion": 9.5, "moisture": 11.1, "cat": "same_dist", "good": true}, {"date": "2024/11/17", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "比叡S(3勝クラス)", "result": 8, "cushion": 11.4, "moisture": 10.0, "cat": "same_dist", "good": false}, {"date": "2024/10/26", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "魚沼S(3勝クラス)", "result": 4, "cushion": 9.4, "moisture": 11.3, "cat": "same_dist", "good": false}]}, {"name": "マイネルクリソーラ", "races": [{"date": "2026/01/18", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "日経新春杯(GII)", "result": 11, "cushion": 10.5, "moisture": 7.4, "cat": "same_dist", "good": false}, {"date": "2025/09/13", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "チャレンジC(GIII)", "result": 3, "cushion": 9.0, "moisture": 11.8, "cat": "same_dist", "good": true}, {"date": "2025/06/01", "venue": "東京", "surface": "芝", "distance": 2500, "race_name": "目黒記念(GII)", "result": 3, "cushion": 9.2, "moisture": 17.7, "cat": "diff_dist", "good": true}, {"date": "2025/05/11", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "メトロポリタンS(L)", "result": 1, "cushion": 9.4, "moisture": 14.8, "cat": "same_dist", "good": true}, {"date": "2025/03/29", "venue": "中山", "surface": "芝", "distance": 2500, "race_name": "日経賞(GII)", "result": 5, "cushion": 9.6, "moisture": 12.6, "cat": "diff_dist", "good": false}, {"date": "2025/01/26", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "アメリカジョッキーC(GII)", "result": 9, "cushion": 9.9, "moisture": 12.1, "cat": "same_dist", "good": false}, {"date": "2024/07/14", "venue": "函館", "surface": "芝", "distance": 2000, "race_name": "函館記念(GIII)", "result": 9, "cushion": 8.3, "moisture": 13.7, "cat": "same_dist", "good": false}, {"date": "2024/05/05", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "新潟大賞典(GIII)", "result": 7, "cushion": 9.0, "moisture": 10.8, "cat": "same_dist", "good": false}, {"date": "2024/02/25", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "中山記念(GII)", "result": 5, "cushion": 8.9, "moisture": 13.4, "cat": "diff_dist", "good": false}, {"date": "2024/01/06", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "日刊スポ賞中山金杯(GIII)", "result": 3, "cushion": 10.4, "moisture": 11.0, "cat": "same_dist", "good": true}]}, {"name": "ジューンテイク", "races": [{"date": "2025/12/13", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "中日新聞杯(GIII)", "result": 3, "cushion": 10.0, "moisture": 10.8, "cat": "same_dist", "good": true}, {"date": "2025/10/05", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "京都大賞典(GII)", "result": 12, "cushion": 10.0, "moisture": 10.3, "cat": "same_dist", "good": false}, {"date": "2025/09/13", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "チャレンジC(GIII)", "result": 10, "cushion": 9.0, "moisture": 11.8, "cat": "same_dist", "good": false}, {"date": "2025/06/15", "venue": "阪神", "surface": "芝", "distance": 2200, "race_name": "宝塚記念(GI)", "result": 16, "cushion": 7.8, "moisture": 17.0, "cat": "same_dist", "good": false}, {"date": "2025/05/10", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "エプソムC(GIII)", "result": 16, "cushion": 8.9, "moisture": 13.4, "cat": "diff_dist", "good": false}, {"date": "2024/09/22", "venue": "中京", "surface": "芝", "distance": 2200, "race_name": "神戸新聞杯(GII)", "result": 2, "cushion": 8.9, "moisture": 15.7, "cat": "same_dist", "good": true}, {"date": "2024/05/26", "venue": "東京", "surface": "芝", "distance": 2400, "race_name": "東京優駿(GI)", "result": 10, "cushion": 9.9, "moisture": 12.3, "cat": "same_dist", "good": false}, {"date": "2024/05/04", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "京都新聞杯(GII)", "result": 1, "cushion": 9.5, "moisture": 8.7, "cat": "same_dist", "good": true}, {"date": "2024/03/16", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "若葉S(L)", "result": 5, "cushion": 9.3, "moisture": 11.4, "cat": "same_dist", "good": false}, {"date": "2024/02/24", "venue": "阪神", "surface": "芝", "distance": 2200, "race_name": "すみれS(L)", "result": 2, "cushion": 8.8, "moisture": 12.1, "cat": "same_dist", "good": true}]}];
const TX = 10.9;
const TY = 9.3;
const COLORS = { same_dist:'#dc2626', diff_dist:'#2563eb', diff_surface:'#94a3b8', target:'#d97706' };
const X_MIN = 7.0, X_MAX = 12.0;
const Y_MIN = 0, Y_MAX = 22;
let selectedHorses = new Set();
const canvas = document.getElementById('chart');
const ctx = canvas.getContext('2d');
const tooltipEl = document.getElementById('tooltip');
const hueStep = 360 / Math.max(HORSES.length, 1);
const horseColors = HORSES.map((_, i) => `hsl(${i * hueStep}, 65%, 55%)`);

function resize() {
  const rect = canvas.parentElement.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0); draw();
}
function toCanvasX(v) { const p=50; const w=canvas.width/(window.devicePixelRatio||1)-p*2; return p+(v-X_MIN)/(X_MAX-X_MIN)*w; }
function toCanvasY(v) { const pt=20,pb=40; const h=canvas.height/(window.devicePixelRatio||1)-pt-pb; return pt+(1-(v-Y_MIN)/(Y_MAX-Y_MIN))*h; }

function draw() {
  const W=canvas.width/(window.devicePixelRatio||1), H=canvas.height/(window.devicePixelRatio||1);
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#f1f5f9'; ctx.lineWidth=1;
  for(let x=Math.ceil(X_MIN);x<=X_MAX;x+=0.5){ const px=toCanvasX(x); ctx.beginPath();ctx.moveTo(px,20);ctx.lineTo(px,H-40);ctx.stroke(); ctx.fillStyle='#94a3b8';ctx.font='10px monospace';ctx.textAlign='center';ctx.fillText(x.toFixed(1),px,H-25); }
  for(let y=0;y<=Y_MAX;y+=2){ const py=toCanvasY(y); ctx.beginPath();ctx.moveTo(50,py);ctx.lineTo(W-50,py);ctx.stroke(); ctx.fillStyle='#94a3b8';ctx.font='10px monospace';ctx.textAlign='right';ctx.fillText(y+'%',45,py+4); }
  ctx.fillStyle='#64748b';ctx.font='bold 11px sans-serif';ctx.textAlign='center';
  ctx.fillText('クッション値',W/2,H-5);
  ctx.save();ctx.translate(12,H/2);ctx.rotate(-Math.PI/2);ctx.fillText('含水率（ゴール前）%',0,0);ctx.restore();
  ctx.fillStyle='rgba(59,130,246,0.04)';
  let sx0=toCanvasX(TX-0.5),sx1=toCanvasX(TX+0.5),sy0=toCanvasY(TY+3),sy1=toCanvasY(TY-3);
  ctx.fillRect(sx0,sy0,sx1-sx0,sy1-sy0);
  ctx.fillStyle='rgba(16,185,129,0.1)';
  let ix0=toCanvasX(TX-0.2),ix1=toCanvasX(TX+0.2),iy0=toCanvasY(TY+1.5),iy1=toCanvasY(TY-1.5);
  ctx.fillRect(ix0,iy0,ix1-ix0,iy1-iy0);
  ctx.setLineDash([5,5]);ctx.strokeStyle='#e2e8f0';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(toCanvasX(TX),20);ctx.lineTo(toCanvasX(TX),H-40);ctx.stroke();
  ctx.beginPath();ctx.moveTo(50,toCanvasY(TY));ctx.lineTo(W-50,toCanvasY(TY));ctx.stroke();
  ctx.setLineDash([]);
  HORSES.forEach((h,hi)=>{
    const isSel=selectedHorses.has(h.name), dimmed=selectedHorses.size>0&&!isSel;
    const alpha=dimmed?0.08:(isSel?1.0:0.7);
    h.races.forEach(r=>{
      const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),color=COLORS[r.cat],sz=isSel?15:10;
      ctx.globalAlpha=alpha;
      if(r.good){ ctx.beginPath();ctx.arc(px,py,sz,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();ctx.strokeStyle=color;ctx.lineWidth=isSel?3.5:2;ctx.stroke(); }
      else{ ctx.strokeStyle=color;ctx.lineWidth=isSel?3.5:2;ctx.beginPath();ctx.moveTo(px-sz,py-sz);ctx.lineTo(px+sz,py+sz);ctx.stroke();ctx.beginPath();ctx.moveTo(px+sz,py-sz);ctx.lineTo(px-sz,py+sz);ctx.stroke(); }
      if(!dimmed){ ctx.fillStyle=color;ctx.font=`bold ${isSel?11:8}px Arial`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.strokeStyle='#fff';ctx.lineWidth=2.5;ctx.strokeText(r.result||'?',px,py+1);ctx.fillText(r.result||'?',px,py+1); }
    });
  });
  ctx.globalAlpha=1;
  const tx=toCanvasX(TX),ty=toCanvasY(TY);
  ctx.strokeStyle=COLORS.target;ctx.lineWidth=3;
  ctx.beginPath();ctx.moveTo(tx-10,ty-10);ctx.lineTo(tx+10,ty+10);ctx.stroke();
  ctx.beginPath();ctx.moveTo(tx+10,ty-10);ctx.lineTo(tx-10,ty+10);ctx.stroke();
  ctx.fillStyle=COLORS.target;ctx.font='bold 10px Arial';ctx.textAlign='center';ctx.fillText('TODAY',tx,ty-16);
}
function buildPanel(){
  const panel=document.getElementById('panel');
  let html='<button class="show-all-btn" id="showAll">全体表示に戻す</button><button class="show-all-btn" id="selectAll" style="margin-bottom:8px;border-color:#f59e0b;color:#f59e0b">全馬チェック</button>';
  HORSES.forEach((h,i)=>{
    const cnt=h.races.length;
    html+=`<button class="horse-btn" data-name="${h.name}" id="btn-${i}"><span class="checkbox" id="chk-${i}"></span><span class="dot" style="background:${horseColors[i]}"></span>${h.name}<span class="count">${cnt>0?cnt+'走':'データなし'}</span></button><div class="horse-detail" id="detail-${i}"><div class="race-card">${h.races.map(r=>{const inIdeal=Math.abs(r.cushion-TX)<=0.2&&Math.abs(r.moisture-TY)<=1.5;return`<div class="race-item ${inIdeal?'ideal':''}"><div class="date">${r.date} ${r.venue}</div><div class="cond">${r.surface}${r.distance}m</div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:2px"><span style="font-size:9px;color:#94a3b8">CV${r.cushion} / ${r.moisture}%</span><span class="result" style="color:${COLORS[r.cat]}">${r.result!==null?r.result+'着':'取消'}</span></div></div>`}).join('')}</div></div>`;
  });
  panel.innerHTML=html;
  document.getElementById('showAll').addEventListener('click',()=>{selectedHorses.clear();updateSelection();});
  document.getElementById('selectAll').addEventListener('click',()=>{HORSES.forEach(h=>selectedHorses.add(h.name));updateSelection();});
  HORSES.forEach((h,i)=>{document.getElementById('btn-'+i).addEventListener('click',()=>{if(selectedHorses.has(h.name))selectedHorses.delete(h.name);else selectedHorses.add(h.name);updateSelection();});});
}
function updateSelection(){
  HORSES.forEach((h,i)=>{
    const btn=document.getElementById('btn-'+i),detail=document.getElementById('detail-'+i),chk=document.getElementById('chk-'+i);
    if(selectedHorses.has(h.name)){btn.classList.add('selected');detail.classList.add('show');chk.textContent='✓';}
    else{btn.classList.remove('selected');detail.classList.remove('show');chk.textContent='';}
  });draw();
}
const isMobile='ontouchstart' in window;
function getPointAt(cx,cy){
  let closest=null,minDist=isMobile?35:20;
  HORSES.forEach(h=>{if(selectedHorses.size>0&&!selectedHorses.has(h.name))return;h.races.forEach(r=>{const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),d=Math.sqrt((cx-px)**2+(cy-py)**2);if(d<minDist){minDist=d;closest={...r,horse:h.name};}});});
  return closest;
}
canvas.addEventListener('mousemove',(e)=>{const rect=canvas.getBoundingClientRect();const x=e.clientX-rect.left,y=e.clientY-rect.top;const pt=getPointAt(x,y);if(pt){tooltipEl.innerHTML=`<b>${pt.horse}</b><br>${pt.date} ${pt.venue} ${pt.surface}${pt.distance}m<br>${pt.race_name}<br><b>${pt.result}着</b><br>CV: ${pt.cushion} / 含水率: ${pt.moisture}%`;tooltipEl.style.left=(e.clientX+15)+'px';tooltipEl.style.top=(e.clientY-10)+'px';tooltipEl.classList.add('show');}else{tooltipEl.classList.remove('show');}});
canvas.addEventListener('mouseleave',()=>tooltipEl.classList.remove('show'));
let touchTimer=null;
function showTooltipAt(cx,cy,tx,ty){const pt=getPointAt(cx,cy);if(pt){tooltipEl.innerHTML=`<b>${pt.horse}</b><br>${pt.date} ${pt.venue} ${pt.surface}${pt.distance}m<br>${pt.race_name}<br><b>${pt.result!==null?pt.result+'着':'取消'}</b><br>CV: ${pt.cushion} / 含水率: ${pt.moisture}%`;const left=Math.min(tx+15,window.innerWidth-260);const top=Math.max(ty-40,10);tooltipEl.style.left=left+'px';tooltipEl.style.top=top+'px';tooltipEl.classList.add('show');}else{tooltipEl.classList.remove('show');}}
canvas.addEventListener('touchstart',(e)=>{const t=e.touches[0];const rect=canvas.getBoundingClientRect();showTooltipAt(t.clientX-rect.left,t.clientY-rect.top,t.clientX,t.clientY);},{passive:true});
canvas.addEventListener('touchmove',(e)=>{const t=e.touches[0];const rect=canvas.getBoundingClientRect();showTooltipAt(t.clientX-rect.left,t.clientY-rect.top,t.clientX,t.clientY);},{passive:true});
canvas.addEventListener('touchend',()=>{if(touchTimer)clearTimeout(touchTimer);touchTimer=setTimeout(()=>tooltipEl.classList.remove('show'),2000);});
canvas.addEventListener('click',(e)=>{const rect=canvas.getBoundingClientRect();const pt=getPointAt(e.clientX-rect.left,e.clientY-rect.top);if(pt){if(selectedHorses.has(pt.horse))selectedHorses.delete(pt.horse);else selectedHorses.add(pt.horse);updateSelection();}});
window.addEventListener('resize',resize); buildPanel(); resize();
</script>
</body></html>