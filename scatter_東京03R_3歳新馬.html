<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>クッション値×含水率 - 東京</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans JP', sans-serif;
  background: #fff; color: #1e293b; overflow-x: hidden;
}
.header {
  background: #fff; border-bottom: 1px solid #e2e8f0;
  padding: 12px 16px; position: sticky; top: 0; z-index: 100;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
.header h1 { font-size: 16px; font-weight: 900; letter-spacing: -0.5px; }
.header .sub { font-size: 11px; color: #64748b; margin-top: 2px; }
.header .target {
  display: inline-flex; gap: 12px; margin-top: 4px;
  font-size: 11px; font-weight: 700; font-family: monospace;
}
.header .target span {
  background: #f8fafc; border: 1px solid #e2e8f0;
  padding: 2px 8px; border-radius: 4px;
}
.main { display: flex; flex-direction: column; }
@media (min-width: 768px) { .main { flex-direction: row; height: calc(100vh - 70px); } }
.chart-area { position: relative; width: 100%; height: 55vh; min-height: 350px; }
@media (min-width: 768px) { .chart-area { flex: 1; height: 100%; } }
canvas { display: block; width: 100% !important; height: 100% !important; touch-action: none; }
.panel {
  border-top: 1px solid #e2e8f0; overflow-y: auto; padding: 8px; background: #f8fafc;
}
@media (min-width: 768px) {
  .panel { width: 320px; border-top: none; border-left: 1px solid #e2e8f0; height: 100%; }
}
.horse-btn {
  display: flex; align-items: center; gap: 10px; width: 100%;
  padding: 10px 14px; margin-bottom: 4px; border: 1px solid #e2e8f0;
  border-radius: 12px; background: #fff; cursor: pointer;
  transition: all 0.2s; font-size: 14px; font-weight: 700; color: #1e293b;
  -webkit-tap-highlight-color: transparent;
}
.horse-btn:active { transform: scale(0.98); }
.horse-btn.selected {
  border-color: #f59e0b; background: #fffbeb;
  box-shadow: 0 0 0 2px rgba(245,158,11,0.2);
}
.horse-btn .count { font-size: 10px; color: #94a3b8; font-weight: 600; margin-left: auto; }
.horse-btn .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.horse-detail { display: none; padding: 8px 4px; }
.horse-detail.show { display: block; }
.race-card { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 6px; }
.race-item {
  padding: 8px 10px; border-radius: 10px; border: 1px solid #e2e8f0;
  background: #fff; font-size: 10px;
}
.race-item.ideal { background: #ecfdf5; border-color: #a7f3d0; }
.race-item .date { color: #94a3b8; font-weight: 600; font-family: monospace; }
.race-item .result { font-size: 13px; font-weight: 900; }
.race-item .cond { color: #64748b; font-weight: 700; }
.legend {
  display: flex; gap: 12px; padding: 8px 16px; font-size: 10px;
  font-weight: 700; color: #94a3b8; border-top: 1px solid #e2e8f0; flex-wrap: wrap;
}
.legend span { display: flex; align-items: center; gap: 4px; }
.legend .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
.tooltip {
  display: none; position: fixed; background: rgba(15,23,42,0.95); color: #fff;
  padding: 10px 14px; border-radius: 10px; font-size: 12px; line-height: 1.6;
  pointer-events: none; z-index: 200; max-width: 250px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.tooltip.show { display: block; }
.show-all-btn {
  display: block; width: 100%; padding: 8px; margin-bottom: 8px;
  border: 2px dashed #cbd5e1; border-radius: 12px; background: transparent;
  cursor: pointer; font-size: 13px; font-weight: 700; color: #64748b;
  -webkit-tap-highlight-color: transparent;
}
.show-all-btn:active { background: #f1f5f9; }
</style>
</head>
<body>
<div class="header">
  <h1>東京  ダ1600m</h1>
  <div class="sub">出走馬 クッション値×含水率 解析</div>
  <div class="target">
    <span>CV: <b style="color:#d97706">9.4</b></span>
    <span>含水率: <b style="color:#2563eb">5.5%</b></span>
    <span style="color:#94a3b8">02/15 東京</span>
  </div>
</div>
<div class="main">
  <div class="chart-area"><canvas id="chart"></canvas><div class="tooltip" id="tooltip"></div></div>
  <div class="panel" id="panel"></div>
</div>
<div class="legend">
  <span><span class="dot" style="background:#dc2626"></span> 同距離帯ダート</span>
  <span><span class="dot" style="background:#2563eb"></span> 他距離ダート</span>
  <span><span class="dot" style="background:#94a3b8"></span> 芝レース</span>
  <span>○ 3着以内 / × 4着以下</span>
</div>
<script>
const HORSES = [{"name": "ニットウライズ", "races": []}, {"name": "モンスターラッシュ", "races": []}, {"name": "ハイバーニアン", "races": []}, {"name": "ルミナスレイナ", "races": []}, {"name": "コウユーダイダイ", "races": []}, {"name": "タマモブレイキン", "races": []}, {"name": "ウェイヴメカニクス", "races": []}, {"name": "タイセイジェイド", "races": []}, {"name": "ハスカップジャム", "races": []}, {"name": "モルペウステソーロ", "races": []}, {"name": "ティアップシャイン", "races": []}, {"name": "エタンセル", "races": []}, {"name": "プレースメント", "races": []}, {"name": "バターショコラ", "races": []}, {"name": "エトワールフィーユ", "races": []}, {"name": "トレンドラド", "races": []}];
const TX = 9.4;
const TY = 5.5;
const COLORS = { same_dist:'#dc2626', diff_dist:'#2563eb', diff_surface:'#94a3b8', target:'#d97706' };
const X_MIN = 7.0, X_MAX = 12.0;
const Y_MIN = 0, Y_MAX = 22;
let selectedHorse = null;
const canvas = document.getElementById('chart');
const ctx = canvas.getContext('2d');
const tooltipEl = document.getElementById('tooltip');
const hueStep = 360 / Math.max(HORSES.length, 1);
const horseColors = HORSES.map((_, i) => `hsl(${i * hueStep}, 65%, 55%)`);

function resize() {
  const rect = canvas.parentElement.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0); draw();
}
function toCanvasX(v) { const p=50; const w=canvas.width/(window.devicePixelRatio||1)-p*2; return p+(v-X_MIN)/(X_MAX-X_MIN)*w; }
function toCanvasY(v) { const pt=20,pb=40; const h=canvas.height/(window.devicePixelRatio||1)-pt-pb; return pt+(1-(v-Y_MIN)/(Y_MAX-Y_MIN))*h; }

function draw() {
  const W=canvas.width/(window.devicePixelRatio||1), H=canvas.height/(window.devicePixelRatio||1);
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#f1f5f9'; ctx.lineWidth=1;
  for(let x=Math.ceil(X_MIN);x<=X_MAX;x+=0.5){ const px=toCanvasX(x); ctx.beginPath();ctx.moveTo(px,20);ctx.lineTo(px,H-40);ctx.stroke(); ctx.fillStyle='#94a3b8';ctx.font='10px monospace';ctx.textAlign='center';ctx.fillText(x.toFixed(1),px,H-25); }
  for(let y=0;y<=Y_MAX;y+=2){ const py=toCanvasY(y); ctx.beginPath();ctx.moveTo(50,py);ctx.lineTo(W-50,py);ctx.stroke(); ctx.fillStyle='#94a3b8';ctx.font='10px monospace';ctx.textAlign='right';ctx.fillText(y+'%',45,py+4); }
  ctx.fillStyle='#64748b';ctx.font='bold 11px sans-serif';ctx.textAlign='center';
  ctx.fillText('クッション値',W/2,H-5);
  ctx.save();ctx.translate(12,H/2);ctx.rotate(-Math.PI/2);ctx.fillText('含水率（ゴール前）%',0,0);ctx.restore();
  ctx.fillStyle='rgba(59,130,246,0.04)';
  let sx0=toCanvasX(TX-0.5),sx1=toCanvasX(TX+0.5),sy0=toCanvasY(TY+3),sy1=toCanvasY(TY-3);
  ctx.fillRect(sx0,sy0,sx1-sx0,sy1-sy0);
  ctx.fillStyle='rgba(16,185,129,0.1)';
  let ix0=toCanvasX(TX-0.2),ix1=toCanvasX(TX+0.2),iy0=toCanvasY(TY+1.5),iy1=toCanvasY(TY-1.5);
  ctx.fillRect(ix0,iy0,ix1-ix0,iy1-iy0);
  ctx.setLineDash([5,5]);ctx.strokeStyle='#e2e8f0';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(toCanvasX(TX),20);ctx.lineTo(toCanvasX(TX),H-40);ctx.stroke();
  ctx.beginPath();ctx.moveTo(50,toCanvasY(TY));ctx.lineTo(W-50,toCanvasY(TY));ctx.stroke();
  ctx.setLineDash([]);
  HORSES.forEach((h,hi)=>{
    const isSel=selectedHorse===h.name, dimmed=selectedHorse!==null&&!isSel;
    const alpha=dimmed?0.08:(isSel?1.0:0.7);
    h.races.forEach(r=>{
      const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),color=COLORS[r.cat],sz=isSel?15:10;
      ctx.globalAlpha=alpha;
      if(r.good){ ctx.beginPath();ctx.arc(px,py,sz,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();ctx.strokeStyle=color;ctx.lineWidth=isSel?3.5:2;ctx.stroke(); }
      else{ ctx.strokeStyle=color;ctx.lineWidth=isSel?3.5:2;ctx.beginPath();ctx.moveTo(px-sz,py-sz);ctx.lineTo(px+sz,py+sz);ctx.stroke();ctx.beginPath();ctx.moveTo(px+sz,py-sz);ctx.lineTo(px-sz,py+sz);ctx.stroke(); }
      if(!dimmed){ ctx.fillStyle=color;ctx.font=`bold ${isSel?11:8}px Arial`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.strokeStyle='#fff';ctx.lineWidth=2.5;ctx.strokeText(r.result||'?',px,py+1);ctx.fillText(r.result||'?',px,py+1); }
    });
  });
  ctx.globalAlpha=1;
  const tx=toCanvasX(TX),ty=toCanvasY(TY);
  ctx.strokeStyle=COLORS.target;ctx.lineWidth=3;
  ctx.beginPath();ctx.moveTo(tx-10,ty-10);ctx.lineTo(tx+10,ty+10);ctx.stroke();
  ctx.beginPath();ctx.moveTo(tx+10,ty-10);ctx.lineTo(tx-10,ty+10);ctx.stroke();
  ctx.fillStyle=COLORS.target;ctx.font='bold 10px Arial';ctx.textAlign='center';ctx.fillText('TODAY',tx,ty-16);
}
function buildPanel(){
  const panel=document.getElementById('panel');
  let html='<button class="show-all-btn" id="showAll">全体表示に戻す</button>';
  HORSES.forEach((h,i)=>{
    const cnt=h.races.length;
    html+=`<button class="horse-btn" data-name="${h.name}" id="btn-${i}"><span class="dot" style="background:${horseColors[i]}"></span>${h.name}<span class="count">${cnt>0?cnt+'走':'データなし'}</span></button><div class="horse-detail" id="detail-${i}"><div class="race-card">${h.races.map(r=>{const inIdeal=Math.abs(r.cushion-TX)<=0.2&&Math.abs(r.moisture-TY)<=1.5;return`<div class="race-item ${inIdeal?'ideal':''}"><div class="date">${r.date} ${r.venue}</div><div class="cond">${r.surface}${r.distance}m</div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:2px"><span style="font-size:9px;color:#94a3b8">CV${r.cushion} / ${r.moisture}%</span><span class="result" style="color:${COLORS[r.cat]}">${r.result}着</span></div></div>`}).join('')}</div></div>`;
  });
  panel.innerHTML=html;
  document.getElementById('showAll').addEventListener('click',()=>{selectedHorse=null;updateSelection();});
  HORSES.forEach((h,i)=>{document.getElementById('btn-'+i).addEventListener('click',()=>{selectedHorse=selectedHorse===h.name?null:h.name;updateSelection();});});
}
function updateSelection(){
  HORSES.forEach((h,i)=>{
    const btn=document.getElementById('btn-'+i),detail=document.getElementById('detail-'+i);
    if(selectedHorse===h.name){btn.classList.add('selected');detail.classList.add('show');}
    else{btn.classList.remove('selected');detail.classList.remove('show');}
  });draw();
}
function getPointAt(cx,cy){
  let closest=null,minDist=20;
  HORSES.forEach(h=>{if(selectedHorse&&selectedHorse!==h.name)return;h.races.forEach(r=>{const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),d=Math.sqrt((cx-px)**2+(cy-py)**2);if(d<minDist){minDist=d;closest={...r,horse:h.name};}});});
  return closest;
}
canvas.addEventListener('mousemove',(e)=>{const rect=canvas.getBoundingClientRect();const x=e.clientX-rect.left,y=e.clientY-rect.top;const pt=getPointAt(x,y);if(pt){tooltipEl.innerHTML=`<b>${pt.horse}</b><br>${pt.date} ${pt.venue} ${pt.surface}${pt.distance}m<br>${pt.race_name}<br><b>${pt.result}着</b><br>CV: ${pt.cushion} / 含水率: ${pt.moisture}%`;tooltipEl.style.left=(e.clientX+15)+'px';tooltipEl.style.top=(e.clientY-10)+'px';tooltipEl.classList.add('show');}else{tooltipEl.classList.remove('show');}});
canvas.addEventListener('mouseleave',()=>tooltipEl.classList.remove('show'));
canvas.addEventListener('touchstart',(e)=>{e.preventDefault();const t=e.touches[0];const rect=canvas.getBoundingClientRect();const pt=getPointAt(t.clientX-rect.left,t.clientY-rect.top);if(pt){tooltipEl.innerHTML=`<b>${pt.horse}</b><br>${pt.date} ${pt.venue} ${pt.surface}${pt.distance}m<br>${pt.race_name}<br><b>${pt.result}着</b><br>CV: ${pt.cushion} / 含水率: ${pt.moisture}%`;tooltipEl.style.left=(t.clientX+15)+'px';tooltipEl.style.top=(t.clientY-40)+'px';tooltipEl.classList.add('show');}},{passive:false});
canvas.addEventListener('touchend',()=>{setTimeout(()=>tooltipEl.classList.remove('show'),2000);});
canvas.addEventListener('click',(e)=>{const rect=canvas.getBoundingClientRect();const pt=getPointAt(e.clientX-rect.left,e.clientY-rect.top);if(pt){selectedHorse=selectedHorse===pt.horse?null:pt.horse;updateSelection();}});
window.addEventListener('resize',resize); buildPanel(); resize();
</script>
</body></html>